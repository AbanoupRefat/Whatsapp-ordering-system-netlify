<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø´Ø±ÙƒØ© Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³ Ù„Ù‚Ø·Ø¹ ØºÙŠØ§Ø± Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@200;300;400;600;700&display=swap" rel="stylesheet">
    <style>
        /* Global Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Cairo', sans-serif;
            direction: rtl;
            text-align: right;
            background-color: #f8fafc;
            line-height: 1.6;
        }
        
        /* Header Styles */
        .company-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .company-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        
        .company-subtitle {
            font-size: 1.2rem;
            font-weight: 300;
            opacity: 0.9;
        }
        
        /* Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        /* Search and Filter Section */
        .search-container {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .search-row {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }
        
        .search-input, .filter-select {
            padding: 0.75rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-family: 'Cairo', sans-serif;
            font-size: 1rem;
            flex: 1;
            min-width: 200px;
        }
        
        .search-input:focus, .filter-select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        /* Cart Summary */
        .cart-summary {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            text-align: center;
        }
        
        .cart-stats {
            display: flex;
            justify-content: space-around;
            margin-top: 1rem;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .cart-stat {
            text-align: center;
        }
        
        .cart-stat-number {
            font-size: 1.5rem;
            font-weight: 700;
            display: block;
        }
        
        .cart-stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-top: 0.25rem;
        }
        
        /* Table Styles */
        .table-container {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    margin-bottom: 2rem;
    background: white;
}

@media (max-width: 768px) {
    .table-container {
        overflow-x: visible;
        border-radius: 0;
        margin: 0 -1rem 2rem -1rem;
    }
}
        
        .products-table {
    width: 100%;
    min-width: 700px;
    border-collapse: collapse;
}

@media (max-width: 768px) {
    .products-table {
        min-width: 100%;
        font-size: 0.85rem;
    }
}
        
        .table-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .table-header th {
            padding: 1rem;
            font-weight: 600;
            text-align: center;
            border-right: 1px solid rgba(255,255,255,0.2);
        }
        
        .table-row {
            border-bottom: 1px solid #e2e8f0;
            transition: background-color 0.2s;
        }
        
        .table-row:hover {
            background-color: #f8fafc;
        }
        
        .table-cell {
            padding: 1rem;
            text-align: center;
            border-right: 1px solid #e2e8f0;
        }
        
        .product-name {
            text-align: right;
            font-weight: 500;
            max-width: 250px;
            word-wrap: break-word;
        }
        
        .price-cell {
            font-weight: 600;
            color: #059669;
        }
        
        .quantity-controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        
        .quantity-btn {
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            width: 35px;
            height: 35px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .quantity-btn:hover {
            background: #5a67d8;
            transform: scale(1.1);
        }
        
        .quantity-display {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            width: 50px;
            height: 35px;
            text-align: center;
            font-weight: 600;
            line-height: 31px;
        }
        
        .subtotal-cell {
            background: #f0f9f4;
            font-weight: 700;
            color: #059669;
        }
        
        /* Category Separator */
        .category-row {
    background: linear-gradient(90deg, #f7fafc 0%, #e2e8f0 50%, #f7fafc 100%);
}
        
        .category-cell {
    text-align: center;
    font-weight: 600;
    padding: 1rem;
    color: #4a5568;
    font-size: 1.1rem;
}
        
        /* Pagination */
        .pagination-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1rem;
            margin: 2rem 0;
            flex-wrap: wrap;
        }
        
        .pagination-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Cairo', sans-serif;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .pagination-btn:hover:not(:disabled) {
            background: #5a67d8;
            transform: translateY(-1px);
        }
        
        .pagination-btn:disabled {
            background: #cbd5e0;
            cursor: not-allowed;
        }
        
        .pagination-info {
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            background: #f7fafc;
            border-radius: 8px;
        }
        
        /* WhatsApp Button */
        .whatsapp-btn {
            background: linear-gradient(135deg, #25d366 0%, #128c7e 100%);
            color: white;
            border: none;
            padding: 1.5rem 3rem;
            border-radius: 12px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            max-width: 400px;
            margin: 2rem auto;
            font-family: 'Cairo', sans-serif;
            transition: all 0.3s;
            text-decoration: none;
            display: block;
            text-align: center;
        }
        
        .whatsapp-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(37, 211, 102, 0.3);
        }
        
        /* Loading and Empty States */
        .loading {
            text-align: center;
            padding: 2rem;
            font-size: 1.2rem;
            color: #667eea;
        }
        
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #6b7280;
        }
        
        .empty-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .company-title {
                font-size: 1.8rem;
            }
            
            .company-subtitle {
                font-size: 1rem;
            }
            
            .container {
                padding: 1rem;
            }
            
            .search-row {
                flex-direction: column;
            }
            
            .cart-stats {
                flex-direction: column;
            }
            
            .table-header th,
            .table-cell {
                padding: 0.5rem;
                font-size: 0.9rem;
            }
            
            .quantity-btn {
                width: 30px;
                height: 30px;
                font-size: 0.9rem;
            }
            
            .quantity-display {
                width: 40px;
                height: 30px;
                line-height: 26px;
            }
            
            .pagination-btn {
                padding: 0.5rem 1rem;
                font-size: 0.9rem;
            }
            /* Mobile table adjustments */
.table-header th {
    padding: 0.5rem 0.25rem;
    font-size: 0.8rem;
}

.table-cell {
    padding: 0.5rem 0.25rem;
    font-size: 0.85rem;
}

.product-name {
    max-width: 120px;
    font-size: 0.8rem;
    line-height: 1.3;
}

.quantity-controls {
    flex-direction: column;
    gap: 0.25rem;
}

.quantity-btn {
    width: 25px;
    height: 25px;
    font-size: 0.8rem;
}

.quantity-display {
    width: 35px;
    height: 25px;
    line-height: 21px;
    font-size: 0.8rem;
}

/* Stack quantity controls vertically on very small screens */
@media (max-width: 480px) {
    .quantity-controls {
        flex-direction: row;
        gap: 0.2rem;
    }
    
    .quantity-btn {
        width: 22px;
        height: 22px;
        font-size: 0.7rem;
    }
    
    .quantity-display {
        width: 30px;
        height: 22px;
        line-height: 18px;
    }
}
        }
        
        /* Hidden class for filtering */
        .hidden {
            display: none;
        }
        
        /* Results info */
        .results-info {
            text-align: center;
            margin: 1rem 0;
            font-size: 1.1rem;
            font-weight: 500;
            padding: 1rem;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        /* Separator Row Style */
        .separator-row-visual {
    background-color: #f8fafc;
    height: 8px;
    border-top: 1px solid #e2e8f0;
    border-bottom: 1px solid #e2e8f0;
}
        .separator-row-visual td {
            padding: 0; /* Remove padding */
        }
    </style>
</head>
<body>
    <!-- Company Header -->
    <div class="company-header">
        <h1 class="company-title">ğŸš— Ø´Ø±ÙƒØ© Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³ Ù„Ù‚Ø·Ø¹ ØºÙŠØ§Ø± Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</h1>
        <p class="company-subtitle">Ù…ØªØ®ØµØµÙˆÙ† ÙÙŠ ØªÙˆÙÙŠØ± Ù‚Ø·Ø¹ ØºÙŠØ§Ø± Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø£ØµÙ„ÙŠØ© ÙˆØ§Ù„Ø¨Ø¯ÙŠÙ„Ø©</p>
    </div>

    <div class="container">
        <!-- Search and Filter Section -->
        <div class="search-container">
            <div class="search-row">
                <input type="text" class="search-input" id="searchInput" placeholder="ğŸ” Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª...">
                <select class="filter-select" id="originFilter">
                    <option value="Ø§Ù„ÙƒÙ„">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†Ø§Ø´Ø¦</option>
                </select>
            </div>
        </div>

        <!-- Results Info -->
        <div class="results-info" id="resultsInfo">
            <div class="loading">â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª...</div>
        </div>

        <!-- Products Table -->
        <div class="table-container">
            <table class="products-table">
                <thead class="table-header">
                    <tr>
                        <th style="width: 250px;">Ø§Ù„Ø¨Ù†Ø¯</th>
                        <th style="width: 100px;">Ø§Ù„Ù…Ù†Ø´Ø£</th>
                        <th style="width: 80px;">Ø§Ù„Ø³Ø¹Ø±</th>
                        <th style="width: 120px;">Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                        <th style="width: 100px;">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
                    </tr>
                </thead>
                <tbody id="productsTableBody">
                    <!-- Products will be loaded here -->
                </tbody>
            </table>
        </div>

        <!-- Pagination -->
        <div class="pagination-container" id="paginationContainer">
            <button class="pagination-btn" id="firstPageBtn">â®ï¸ Ø§Ù„Ø£ÙˆÙ„Ù‰</button>
            <button class="pagination-btn" id="prevPageBtn">âª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©</button>
            <div class="pagination-info" id="pageInfo">ØµÙØ­Ø© 1 Ù…Ù† 1</div>
            <button class="pagination-btn" id="nextPageBtn">Ø§Ù„ØªØ§Ù„ÙŠØ© â©</button>
            <button class="pagination-btn" id="lastPageBtn">Ø§Ù„Ø£Ø®ÙŠØ±Ø© â­ï¸</button>
        </div>

        <!-- Cart Summary -->
        <div class="cart-summary" id="cartSummary" style="display: none;">
            <h3>ğŸ›’ Ø³Ù„Ø© Ø§Ù„ØªØ³ÙˆÙ‚</h3>
            <div class="cart-stats">
                <div class="cart-stat">
                    <span class="cart-stat-number" id="cartItems">0</span>
                    <span class="cart-stat-label">Ø£ØµÙ†Ø§Ù</span>
                </div>
                <div class="cart-stat">
                    <span class="cart-stat-number" id="cartQuantity">0</span>
                    <span class="cart-stat-label">Ù‚Ø·Ø¹Ø©</span>
                </div>
                <div class="cart-stat">
                    <span class="cart-stat-number" id="cartTotal">0</span>
                    <span class="cart-stat-label">Ø¬.Ù… Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</span>
                </div>
            </div>
        </div>

        <!-- WhatsApp Button -->
        <a href="#" class="whatsapp-btn" id="whatsappBtn" style="display: none;">
            ğŸ“± Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ÙŠØ© Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨
        </a>
    </div>

    <script>
        // App State
        let products = [];
        let filteredProducts = [];
        let cart = {};
        let currentPage = 1;
        const itemsPerPage = 15;
        const whatsappNumber = '201234567890'; // Replace with your WhatsApp number

        // Remove sample data - data will now be fetched from Netlify Function
        // const sampleProducts = [...];

        // Initialize the app
        // Initialize the app
async function initApp() {
    const resultsInfo = document.getElementById('resultsInfo');
    resultsInfo.innerHTML = '<div class="loading">â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª...</div>';

    console.log('Starting app initialization...');

    // Try multiple URLs to see which one works
    const urlsToTry = [
        '/api/get-products',
        '/.netlify/functions/get-products'
    ];

    for (const url of urlsToTry) {
        try {
            console.log(`Trying to fetch from: ${url}`);
            
            const response = await fetch(url, {
                method: 'GET',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                }
            });
            
            console.log(`Response for ${url}:`, {
                status: response.status,
                statusText: response.statusText,
                ok: response.ok,
                headers: Object.fromEntries(response.headers.entries())
            });

            if (!response.ok) {
                const errorText = await response.text();
                console.error(`Error response from ${url}:`, errorText);
                
                if (url === urlsToTry[urlsToTry.length - 1]) {
                    // This is the last URL to try
                    throw new Error(`HTTP ${response.status}: ${response.statusText} - ${errorText}`);
                }
                continue; // Try next URL
            }

            const contentType = response.headers.get('Content-Type');
            console.log(`Content-Type from ${url}:`, contentType);

            let data;
            if (contentType && contentType.includes('application/json')) {
                data = await response.json();
            } else {
                const text = await response.text();
                console.log(`Non-JSON response from ${url}:`, text.substring(0, 200));
                throw new Error(`Expected JSON but got: ${contentType}`);
            }

            console.log(`Successfully fetched data from ${url}:`, {
                productsCount: data.products?.length,
                meta: data.meta,
                sampleProduct: data.products?.[0]
            });

            products = data.products || [];
            
            if (products.length === 0) {
                resultsInfo.innerHTML = '<div class="empty-state"><div class="empty-icon">ğŸ“¦</div><div>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</div></div>';
                return;
            }

            populateOriginFilter();
            filterProducts();
            setupEventListeners();
            
            console.log('App initialization completed successfully');
            return; // Success, exit the loop

        } catch (error) {
            console.error(`Error with URL ${url}:`, error);
            
            if (url === urlsToTry[urlsToTry.length - 1]) {
                // This is the last URL, show error
                console.error('All URLs failed, showing error to user');
                resultsInfo.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">âŒ</div>
                        <div>ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</div>
                        <div style="font-size: 0.9rem; color: #666; margin-top: 0.5rem;">
                            Ø®Ø·Ø£: ${error.message}
                        </div>
                        <div style="font-size: 0.8rem; color: #888; margin-top: 0.5rem;">
                            Ø§Ù„Ø±Ø¬Ø§Ø¡ ÙØªØ­ Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø·ÙˆØ± Ù„Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„ØªÙØ§ØµÙŠÙ„
                        </div>
                    </div>
                `;
            }
        }
    }
}

        // Setup event listeners
        function setupEventListeners() {
            document.getElementById('searchInput').addEventListener('input', handleSearch);
            document.getElementById('originFilter').addEventListener('change', handleFilter);
            
            // Pagination buttons
            document.getElementById('firstPageBtn').addEventListener('click', () => goToPage(1));
            document.getElementById('prevPageBtn').addEventListener('click', () => goToPage(currentPage - 1));
            document.getElementById('nextPageBtn').addEventListener('click', () => goToPage(currentPage + 1));
            document.getElementById('lastPageBtn').addEventListener('click', () => goToPage(getTotalPages()));
        }

        // Populate origin filter dropdown
        function populateOriginFilter() {
            const origins = [...new Set(products.map(p => p.origin))].sort();
            const select = document.getElementById('originFilter');
            
            // Clear existing options except "Ø§Ù„ÙƒÙ„"
            select.innerHTML = '<option value="Ø§Ù„ÙƒÙ„">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†Ø§Ø´Ø¦</option>';
            
            origins.forEach(origin => {
                const option = document.createElement('option');
                option.value = origin;
                option.textContent = origin;
                select.appendChild(option);
            });
        }

        // Handle search
        function handleSearch() {
            currentPage = 1;
            filterProducts();
        }

        // Handle filter
function handleFilter() {
    currentPage = 1;
    filterProducts();
}

// Filter products based on search and filter criteria
function filterProducts() {
    const searchTerm = document.getElementById('searchInput').value.trim().toLowerCase();
    const originFilter = document.getElementById('originFilter').value;
    
    filteredProducts = products.filter(product => {
        const productName = (product.name || '').trim().toLowerCase();
        const matchesSearch = productName.includes(searchTerm);
        const matchesOrigin = originFilter === 'Ø§Ù„ÙƒÙ„' || product.origin === originFilter;
        return matchesSearch && matchesOrigin;
    });
    
    renderProducts();
    updatePagination();
    updateResultsInfo();
    scrollToTableHeaders();
}

// Render products table
// Render products table
function renderProducts() {
    const tbody = document.getElementById('productsTableBody');
    tbody.innerHTML = '';

    const startIdx = (currentPage - 1) * itemsPerPage;
    const endIdx = startIdx + itemsPerPage;
    const pageProducts = filteredProducts.slice(startIdx, endIdx);

    let currentCategory = '';

    pageProducts.forEach(product => {
        // Handle empty row separators (sub-category breaks)
        if (product.isSeparator) {
            const separatorRow = document.createElement('tr');
            separatorRow.className = 'separator-row-visual';
            separatorRow.innerHTML = `<td colspan="5"></td>`;
            tbody.appendChild(separatorRow);
            return;
        }

        // Handle category change (main category separator)
        if (product.category && product.category !== currentCategory) {
            currentCategory = product.category;
            const categoryRow = document.createElement('tr');
            categoryRow.className = 'category-row';
            categoryRow.innerHTML = `
                <td colspan="5" class="category-cell">${currentCategory}</td>
            `;
            tbody.appendChild(categoryRow);
        }

        // Create consistent product key
        const productKey = product.id || product.name;
        const quantity = cart[productKey]?.quantity || 0;
        const price = parseFloat(product.price);
        const subtotal = quantity * price;

        // Add product row (only products with data)
        const row = document.createElement('tr');
        row.className = 'table-row';
        row.innerHTML = `
            <td class="table-cell product-name">${product.name}</td>
            <td class="table-cell">${product.origin}</td>
            <td class="table-cell price-cell">${price.toFixed(0)} Ø¬.Ù…</td>
            <td class="table-cell">
                <div class="quantity-controls">
                    <button class="quantity-btn" onclick="updateQuantity('${productKey.replace(/'/g, "\\'")}', ${price}, -1)">â–</button>
                    <div class="quantity-display">${quantity}</div>
                    <button class="quantity-btn" onclick="updateQuantity('${productKey.replace(/'/g, "\\'")}', ${price}, 1)">â•</button>
                </div>
            </td>
            <td class="table-cell subtotal-cell">${subtotal.toFixed(0)} Ø¬.Ù…</td>
        `;
        tbody.appendChild(row);
    });

    if (pageProducts.length === 0) {
        const emptyRow = document.createElement('tr');
        emptyRow.innerHTML = `
            <td colspan="5" class="table-cell">
                <div class="empty-state">
                    <div class="empty-icon">ğŸ”</div>
                    <div>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª ØªØ·Ø§Ø¨Ù‚ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…Ø­Ø¯Ø¯</div>
                </div>
            </td>
        `;
        tbody.appendChild(emptyRow);
    }

    updatePagination();
    updateResultsInfo();
}}

        // Update quantity in cart
        function updateQuantity(productId, price, change) {
    // Ensure we have a consistent product identifier
    const productKey = productId;
    
    if (!cart[productKey]) {
        cart[productKey] = { quantity: 0, price: parseFloat(price) };
    }

    const newQuantity = cart[productKey].quantity + change;

    if (newQuantity <= 0) {
        delete cart[productKey];
    } else {
        cart[productKey].quantity = newQuantity;
    }

    updateCartSummary();
    // Instead of re-rendering entire table, update specific row
    updateProductRow(productKey);
}
        function updateProductRow(productKey) {
    // Find all table rows
    const rows = document.querySelectorAll('.table-row');
    
    rows.forEach(row => {
        // Check if this row contains our product by looking at the onclick attributes
        const minusBtn = row.querySelector('.quantity-btn[onclick*="' + productKey + '"]');
        if (minusBtn) {
            const quantity = cart[productKey]?.quantity || 0;
            const price = cart[productKey]?.price || 0;
            const subtotal = quantity * price;
            
            // Update quantity display
            const quantityDisplay = row.querySelector('.quantity-display');
            if (quantityDisplay) {
                quantityDisplay.textContent = quantity;
            }
            
            // Update subtotal
            const subtotalCell = row.querySelector('.subtotal-cell');
            if (subtotalCell) {
                subtotalCell.textContent = subtotal.toFixed(0) + ' Ø¬.Ù…';
            }
        }
    });
}

        // Update cart summary
        function updateCartSummary() {
            const cartSummary = document.getElementById('cartSummary');
            const whatsappBtn = document.getElementById('whatsappBtn');

            const cartItems = Object.keys(cart).length;
            const totalQuantity = Object.values(cart).reduce((sum, item) => sum + item.quantity, 0);
            const totalCost = Object.values(cart).reduce((sum, item) => sum + (item.quantity * item.price), 0);

            if (cartItems > 0) {
                cartSummary.style.display = 'block';
                whatsappBtn.style.display = 'block';

                document.getElementById('cartItems').textContent = cartItems;
                document.getElementById('cartQuantity').textContent = totalQuantity;
                document.getElementById('cartTotal').textContent = totalCost.toFixed(0);

                // Update WhatsApp button
                const message = generateWhatsAppMessage();
                const whatsappUrl = `https://wa.me/${whatsappNumber}?text=${encodeURIComponent(message)}`;
                whatsappBtn.href = whatsappUrl;
            } else {
                cartSummary.style.display = 'none';
                whatsappBtn.style.display = 'none';
            }
        }

        // Generate WhatsApp message
        function generateWhatsAppMessage() {
    const now = new Date();
    const date = now.toLocaleString('ar-EG');

    let message = `ğŸŒŸ *Ø´Ø±ÙƒØ© Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³ Ù„Ù‚Ø·Ø¹ ØºÙŠØ§Ø± Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª* ğŸŒŸ\n\n`;
    message += `ğŸ“… *ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ù„Ø¨:* ${date}\n\n`;
    message += `ğŸ“‹ *ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ÙŠØ©:*\n\n`;

    let totalCost = 0;
    let totalItems = 0;

    Object.entries(cart).forEach(([productId, details]) => {
        const subtotal = details.quantity * details.price;
        totalCost += subtotal;
        totalItems += details.quantity;

        // Find the product name from the products array
        const product = products.find(p => p.id === productId) || 
                      products.find(p => p.name === productId);
        const productName = product ? product.name : productId;

        message += `ğŸ”¹ *${productName}*\n`;
        message += `   Ø§Ù„ÙƒÙ…ÙŠØ©: ${details.quantity}\n`;
        message += `   Ø§Ù„Ø³Ø¹Ø±: ${details.price} Ø¬.Ù…\n`;
        message += `   Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${subtotal} Ø¬.Ù…\n\n`;
    });

    message += `${'â”€'.repeat(30)}\n`;
    message += `ğŸ“Š *Ù…Ù„Ø®Øµ Ø§Ù„Ø·Ù„Ø¨ÙŠØ©:*\n`;
    message += `   ğŸ“¦ Ø¹Ø¯Ø¯ Ø§Ù„Ø£ØµÙ†Ø§Ù: ${Object.keys(cart).length}\n`;
    message += `   ğŸ›’ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù‚Ø·Ø¹: ${totalItems}\n`;
    message += `   ğŸ’° Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ: *${totalCost.toFixed(2)} Ø¬.Ù…*\n\n`;
    message += `Ø´ÙƒØ±Ø§Ù‹ Ù„Ø«Ù‚ØªÙƒÙ… Ø¨Ù†Ø§! ğŸ™\n`;
    message += `Ø³ÙŠØªÙ… Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ÙƒÙ… Ù‚Ø±ÙŠØ¨Ø§Ù‹ Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ÙŠØ©.`;

    return message;
}

        // Pagination functions
        function getTotalPages() {
            return Math.ceil(filteredProducts.length / itemsPerPage) || 1;
        }

        function goToPage(page) {
            const totalPages = getTotalPages();
            if (page >= 1 && page <= totalPages) {
                currentPage = page;
                renderProducts();
                updatePagination();
            }
        }

        function updatePagination() {
            const totalPages = getTotalPages();
            
            document.getElementById('pageInfo').textContent = `ØµÙØ­Ø© ${currentPage} Ù…Ù† ${totalPages}`;
            
            document.getElementById('firstPageBtn').disabled = currentPage === 1;
            document.getElementById('prevPageBtn').disabled = currentPage === 1;
            document.getElementById('nextPageBtn').disabled = currentPage === totalPages;
            document.getElementById('lastPageBtn').disabled = currentPage === totalPages;
        }

        function updateResultsInfo() {
            const resultsInfo = document.getElementById('resultsInfo');
            if (filteredProducts.length > 0) {
                const startIdx = (currentPage - 1) * itemsPerPage;
                const endIdx = Math.min(startIdx + itemsPerPage, filteredProducts.length);
                const showing = Math.min(itemsPerPage, filteredProducts.length - startIdx);
                
                resultsInfo.innerHTML = 
                    `ğŸ“Š Ø¹Ø±Ø¶ ${showing} Ù…Ù† Ø£ØµÙ„ ${filteredProducts.length} Ù…Ù†ØªØ¬ | ØµÙØ­Ø© ${currentPage} Ù…Ù† ${getTotalPages()}`;
            } else if (document.getElementById('searchInput').value || document.getElementById('originFilter').value !== 'Ø§Ù„ÙƒÙ„') {
                resultsInfo.innerHTML = '<div class="empty-state"><div class="empty-icon">ğŸ”</div><div>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª ØªØ·Ø§Ø¨Ù‚ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…Ø­Ø¯Ø¯</div></div>';
            } else {
                resultsInfo.innerHTML = '<div class="loading">â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª...</div>'; // Default loading if no products yet
            }
        }

        // New function: Scroll to table headers
        function scrollToTableHeaders() {
            const tableHeader = document.querySelector('.table-header');
            if (tableHeader) {
                tableHeader.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }

        // Initialize app when page loads
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
